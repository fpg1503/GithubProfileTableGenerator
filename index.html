<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="content-type" content="text/html; charset=UTF-8">
        <script type="text/javascript" src="https://unpkg.com/marked@0.3.6"></script>
        <script type="text/javascript" src="https://unpkg.com/lodash@4.16.0"></script>
        <script type="text/javascript" src="https://unpkg.com/vue@latest/dist/vue.js"></script>
        <link rel="stylesheet" href="style.css" type="text/css"/>
        
        <title>Github Profile Table Generator</title>
        <script type='text/javascript'>//<![CDATA[
            window.onload=function(){
            function line(ids) {
              first = "|" + ids.map(id => " ![](https://github.com/" + id + ".png?size=117) |").join("")
              second = "|" + ids.map(id => " --- |").join("")
              third = "|" + ids.map(id => "[" + id + "](https://github.com/" + id + ") |").join("")
            
              return first + "\n" + second + "\n" + third
            }
            
            function table(input) {
              ids = input.split(",").map(id =>
                id.trim()
              )
            
              size = 6
              lines = ids.map((e, i) =>
                i % size === 0 ? ids.slice(i, i + size) : null
              ).filter(e => e)
            
              return lines.map(line).join("\n\n")
            }
            
            function copyToClipboard(textArea) {
              textArea.select()
            
              try {
                var successful = document.execCommand('copy')
                var msg = successful ? 'copied successfully!' : 'couldn\'t be copied :('
                textArea.value = "Code " + msg
              } catch (err) {
                console.log('Oops, unable to copy');
              }
            }
            
            new Vue({
              el: '#ids',
              data: {
                input: 'fpg1503'
              },
              computed: {
                markdown: function() {
                  return table(this.input)
                },
                compiledMarkdown: function() {
                  tabled = table(this.input)
                  return marked(tabled, {
                    sanitize: true
                  })
                }
              },
              methods: {
                update: _.debounce(function(e) {
                  this.input = e.target.value
                }, 300),
                copy: function(e) {
                  copyToClipboard(document.querySelector('#markdown'))
                }
              }
            })
            
            }//]]> 
            
        </script>
    </head>
    <body>
        <div id="ids">
            <label>GitHub IDs:</label>
            <br/>
            <input type="text" :value="input" @input="update" />
            <br/>
            <label>CÃ³digo Gerado:</label>
            <br/>
            <textarea v-html="markdown" id="markdown"></textarea>
            <br/>
            <button v-on:click="copy">Copy code to clipboard</button>
            <br/>
            <br/>
            <label>Exemplo:</label>
            <div v-html="compiledMarkdown"></div>
            <br/>
        </div>
    </body>
</html>
